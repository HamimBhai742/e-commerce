
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User{
  id String  @id @default(uuid())
  name String
  email String      @unique
  password String
  role Role            @default(user)
  isVerified Boolean @default(false)
  isDeleted Boolean @default(false)
  otp       String? 
  otpExpiresAt   DateTime?  
 review  Review[]
 cart Cart[]
 address Address[] 
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("users")
  orders Order[]
  payments Payment[]
  userSubscriptions UserSubscription[]
}

model Address{
  id String @id @default(uuid())
  aptNumber String
  aptName String
  street String
  sub_district String
  district String
  postalCode String
  isDefault Boolean @default(false)
  phone String  @unique
  address String?
  userId String 
  user User @relation(fields: [userId],references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("address")
  orders Order[]
}


model Product {
  id               String   @id @default(uuid())
  name             String
  slug             String   @unique
  description      String
  shortDescription String?
  price            Float
  discountPrice    Float?
  sku              String   @unique
  stock            Int
  isInStock        Boolean  @default(true)
  status           String   @default("active")

  thumbnail        String

  weight           Float?
  material         String?

  rating           Float    @default(0)
  reviewCount      Int      @default(0)

  cart Cart[]

  isFeatured       Boolean  @default(false)
  review            Review[]
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  @@map("products")
}

model Review {
  id String @id @default(uuid())
  review String
  userId String
  productId String
  product Product @relation(fields: [productId],references: [id])
  user User   @relation(fields: [userId],references: [id])

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  @@unique([productId,userId])
  @@map("reviews")
}


model Cart{
  id String @id @default(uuid())
  productId String
  product Product @relation(fields: [productId],references: [id])
  userId String
  user User @relation(fields: [userId],references: [id])
  quantity Float @default(1)
  amount Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([productId,userId])
  @@map("carts")
}


model Payment{
  id String @id @default(uuid())
  status PaymentStatus @default(PENDING)
  sub_total Float 
  orders Order[]
  userId String
  user User @relation(fields: [userId],references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("payments")
}


model Order{
  id String @id @default(uuid())
  order_number String @unique
  total_amount Float 
  status OrderStatus @default(PAYMENT_PENDING)
  userId String
  user User @relation(fields: [userId],references: [id])
  items String[]
  paymentId String
  payment Payment  @relation(fields: [paymentId],references: [id])
  addressId String
  address Address @relation(fields: [addressId],references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orders")
}

model SubscriptionPlan {
  id String @id @default(uuid())
  name String
  price Float
  currency String
  billingPeriod String 
  features String[]
   productId String
  pricingId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@map("subscription_plans")
  userSubscriptions UserSubscription[]
}


model UserSubscription {
  id String @id @default(uuid())
  userId String
  user User @relation(fields: [userId],references: [id])
  planId String
  plan SubscriptionPlan @relation(fields: [planId],references: [id])
  status SubscriptionStatus @default(INACTIVE)
  transactionId String?
  paymentMethod String?
  startDate DateTime?
  endDate DateTime?

  cancelAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, planId], name: "userId_planId_unique")
  @@map("user_subscriptions")
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
}

enum PaymentStatus {
  PENDING
  CASH
  PAID
  FAILED
  CANCELLED
  REFUNDED
}

enum OrderStatus {
  PROCESSING
  PAYMENT_PENDING 
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
  FAILED
}





enum Role {
  user
 admin
}
